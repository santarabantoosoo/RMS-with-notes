<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>RMS-preface</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="RMS-preface_files/libs/clipboard/clipboard.min.js"></script>
<script src="RMS-preface_files/libs/quarto-html/quarto.js"></script>
<script src="RMS-preface_files/libs/quarto-html/popper.min.js"></script>
<script src="RMS-preface_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="RMS-preface_files/libs/quarto-html/anchor.min.js"></script>
<link href="RMS-preface_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="RMS-preface_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="RMS-preface_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="RMS-preface_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="RMS-preface_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="RMS-preface_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="RMS-preface_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="RMS-preface_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">RMS-preface</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><img src="logo.png" width="40%"></p>
<div class="cell page-columns page-full" data-fig-width="8">
<div class="cell-output-display column-screen-inset-right">
<div>
<p>
</p><pre class="mermaid mermaid-js" data-tooltip-selector="#mermaid-tooltip-1">flowchart LR
rms[Multivariable Model Development] --&gt; est[Estimation] --&gt; pred[Prediction] --&gt; val[Validation]
</pre>
<div id="mermaid-tooltip-1" class="mermaidTooltip">

</div>
<p></p>
</div>
</div>
</div>
<section id="preface" class="level1 unnumbered page-columns page-full">
<h1 class="unnumbered">Preface</h1>
<p><strong>hamza == I will add notes that I found helpful while studying the book.If math formulas didn’t render properly in your browser, install <a href="https://chrome.google.com/webstore/detail/math-anywhere/gebhifiddmaaeecbaiemfpejghjdjmhc/related" class="uri">https://chrome.google.com/webstore/detail/math-anywhere/gebhifiddmaaeecbaiemfpejghjdjmhc/related</a></strong></p>
<p>All standard regression models have assumptions that must be verified for the model to have power to test hypotheses and for it to be able to predict accurately. Of the principal assumptions (linearity, additivity, distributional), this course will emphasize methods for assessing and satisfying the first two. Practical but powerful tools are presented for validating model assumptions and presenting model results. This course provides methods for estimating the shape of the relationship between predictors and response using the widely applicable method of augmenting the design matrix using restricted cubic splines. Even when assumptions are satisfied, overfitting can ruin a model’s predictive ability for future observations. Methods for data reduction will be introduced to deal with the common case where the number of potential predictors is large in comparison with the number of observations. Methods of model validation (bootstrap and cross-validation) will be covered, as will auxiliary topics such as modeling interaction surfaces, efficiently utilizing partial covariable data by using multiple imputation, variable selection, overly influential observations, collinearity, and shrinkage, and a brief introduction to the <code>R</code> <code>rms</code> package for handling these problems. The methods covered will apply to almost any regression model, including ordinary least squares, longitudinal models, logistic regression models, ordinal regression, quantile regression, longitudinal data analysis, and survival models. Statistical models will be contrasted with machine learning so that the student can make an informed choice of predictive tools.</p>
<section id="target-audience" class="level2">
<h2 class="anchored" data-anchor-id="target-audience">Target Audience</h2>
<p>Statisticians and persons from other quantitative disciplines who are interested in multivariable regression analysis of univariate responses, in developing, validating, and graphically describing multivariable predictive models and in covariable adjustment in clinical trials. The course will be of particular interest to applied statisticians and developers of applied statistics methodology, graduate students, clinical and pre-clinical biostatisticians, health services and outcomes researchers, econometricians, psychometricians, and quantitative epidemiologists. A good command of ordinary multiple regression is a prerequisite.</p>
</section>
<section id="learning-goals" class="level2">
<h2 class="anchored" data-anchor-id="learning-goals">Learning Goals</h2>
<p>Students will</p>
<ul>
<li>be able to fit multivariable regression models:
<ul>
<li>accurately</li>
<li>in a way the sample size will allow, without overfitting</li>
<li>uncovering complex non–linear or non–additive relationships</li>
<li>testing for and quantifying the association between one or more predictors and the response, with possible adjustment for other factors</li>
<li>making maximum use of partial data rather than deleting observations containing missing variables</li>
</ul></li>
<li>be able to validate models for predictive accuracy and to detect overfitting and understand problems caused by overfitting.</li>
<li>learn techniques of “safe data mining” in which significance levels, confidence limits, and measures such as <span class="math inline">\(R^2\)</span> have the claimed properties.</li>
<li>learn how to interpret fitted models using both parameter estimates and graphics</li>
<li>learn about the advantages of semiparametric ordinal models for continuous <span class="math inline">\(Y\)</span></li>
<li>learn about some of the differences between frequentist and Bayesian approaches to statistical modeling</li>
<li>learn differences between machine learning and statistical models, and how to determine the better approach depending on the nature of the problem</li>
</ul>
</section>
<section id="sec-philosophy" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-philosophy">Course Philosophy</h2>
<div class="page-columns page-full"><p> </p><div class="no-row-height column-margin column-container"><span class=""><audio controls=""><source src="http://hbiostat.org/audio/rms/philosophy.mp3" data-external="1" type="audio/mpeg"></audio></span><span class="">The audio narration starts with the third bullet point listed here.</span></div></div>
<ul>
<li><p>Modeling is the endeavor to transform data into information and information into either prediction or evidence about the data generating mechanism<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p></li>
<li><p>Models are usually the best descriptive statistics</p>
<ul>
<li>adjust for one variable while displaying the association with <span class="math inline">\(Y\)</span> and another variable</li>
<li>descriptive statistics do not work in higher dimensions</li>
</ul></li>
<li><p>Satisfaction of model assumptions improves precision and increases statistical power</p>
<ul>
<li>Be aware of assumptions, especially those mattering the most</li>
</ul></li>
<li><p>It is more productive to make a model fit step by step (e.g., transformation estimation) than to postulate a simple model and find out what went wrong</p>
<p><strong>hamza from audio: simple model and find out what went wrong means trial and error. For example, trying multiple transformations and checking which one works best (best R2 for ex.). This may affect the type 1 error and CI coverage. The alternative is to do it step by step. First, estimate the best transformation. Second, fit the model based on that transformation</strong></p>
<ul>
<li>Model diagnostics are often not actionable</li>
<li>Changing the model in reaction to observed patterns <span class="math inline">\(\uparrow\)</span> uncertainty but is reflected by an apparent <span class="math inline">\(\downarrow\)</span> in uncertainty</li>
</ul></li>
<li><p>Graphical methods should be married to formal inference</p></li>
<li><p>Overfitting occurs frequently, so data reduction and model validation are important</p></li>
<li><p>Software without multiple facilities for assessing and fixing model fit may only seem to be user-friendly</p></li>
<li><p>Carefully fitting an improper model is better than badly fitting (and overfitting) a well-chosen one</p>
<ul>
<li><p>E.g. small <span class="math inline">\(N\)</span> and overfitting vs.&nbsp;carefully formulated right hand side of model</p>
<p><strong>hamza from audio: 25 events in survival fitted with 15 covariates using a good model like cox PH will defintely lead to overfitting. However, fitting a log normal survival model that is smartly predefined with 3 covariates will have better reuslts</strong></p></li>
</ul></li>
<li><p>Methods which work for all types of regression models are the most valuable.</p></li>
<li><p>In most research projects the cost of data collection far outweighs the cost of data analysis, so it is important to use the most efficient and accurate modeling techniques, to avoid categorizing continuous variables, and to not remove data from the estimation sample just to be able to validate the model.</p>
<ul>
<li>A $100 analysis can make a $1,000,000 study worthless.</li>
</ul></li>
<li><p>The bootstrap is a breakthrough for statistical modeling and model validation.</p></li>
<li><p>Bayesian modeling is ready for prime time.</p>
<ul>
<li>Can incorporate non-data knowledge</li>
<li>Provides full exact inferential tools even when penalizing <span class="math inline">\(\beta\)</span></li>
<li>Rational way to account for model uncertainty</li>
<li>Direct inference: evidence for all possible values of <span class="math inline">\(\beta\)</span></li>
<li>More accurate way of dealing with missing data</li>
</ul></li>
<li><p>Using the data to guide the data analysis is almost as dangerous as not doing so. <strong>hamza: although <a href="https://kozyrkov.medium.com">cassie kozyrgov</a> said that we can never sneak peak into the data and we need to have everything prespecfied. ie. hypothesis stated. Frank is saying here that we need some tradeoff between sneaking into the data to better fit the model and not sneaking to avoid overfitting. I think we need to be strict about sneaking on the hypothesis (no sneaking). However, we may do some data analysis to check for interactions for example. Also the chunk tests that will be discussed later might be useful</strong></p></li>
<li><p>A good overall strategy is to decide how many degrees of freedom (i.e., number of regression parameters) can be “spent”, where they should be spent, to spend them with no regrets. See the excellent text <em>Clinical Prediction Models</em> <span class="citation" data-cites="cpm">[@cpm]</span></p>
<p><strong>hamza: regret is your enemy. Regret can lead to turn back and tinker with the model to improve fit. Watch out, you are distorting the essence of inference</strong></p></li>
</ul>
<p>For information about adding annotations, comments, and questions inside the text click here: <a href="https://hbiostat.org/comment.html" target="popup" onclick="window.open('https://hbiostat.org/comment.html', 'popup',
     'width=450,height=600'); return false;"> <small>Comments</small> </a></p>
<section id="symbols-used-in-the-right-margin-of-the-text" class="level3">
<h3 class="anchored" data-anchor-id="symbols-used-in-the-right-margin-of-the-text">Symbols Used in the Right Margin of the Text</h3>
<ul>
<li><img src="movie.png" width="15px"> in the right margin is a hyperlink to a YouTube video related to the subject.</li>
<li><img src="discourse.png" width="15px"> is a hyperlink to the discussion topic in <code>datamethods.org</code> devoted to the specific topic. You can go directly to the discussion about chapter <code>n</code> by going to <code>datamethods.org/rmsn</code>.</li>
<li>An audio player symbol indicates that narration elaborating on the notes is available for the section. Red letters and numbers in the right margin are cues referred to within the audio recordings.</li>
<li><span style="color:blue;">blog</span> in the right margin is a link to a blog entry that further discusses the topic.</li>
</ul>
</section>
</section>
<section id="other-information" class="level2">
<h2 class="anchored" data-anchor-id="other-information">Other Information</h2>
<ul>
<li><a href="http://datamethods.org/rms">Discussion board for the overall course</a></li>
<li><a href="https://hbiostat.org/rms">RMS main web site</a></li>
<li>Twitter: <code>#rmscourse</code></li>
<li>Publicly available videos of the short course
<ul>
<li><a href="https://youtu.be/UPcpkIJXlvY">Four hour short course</a> from useR!2022</li>
</ul></li>
<li><a href="https://hbiostat.org/bbrc">BBR course</a></li>
<li>Go directly to a YouTube video for RMS Session <code>n</code> by going to <code>bit.ly/yt-rmsn</code></li>
<li><a href="https://hbiostat.org/rms/qstudy.html">Study questions</a></li>
<li><a href="http://datamethods.org">Datamethods discussion board</a></li>
<li><a href="https://hbiostat.org/bib">Statistical papers written for clinical researchers</a></li>
<li><a href="https://fharrell.com/post/modplan">RMS overview and template for statistical analysis plan</a></li>
<li><a href="https://fharrell.com">Statistical Thinking blog</a></li>
<li><a href="https://paper.li/stn">Statistical Thinking News</a></li>
<li><a href="https://hbiostat.org/glossary">Glossary of statistical terms</a></li>
<li><a href="https://hbiostat.org/rflow">R Workflow</a></li>
</ul>
</section>
<section id="r-packages" class="level2">
<h2 class="anchored" data-anchor-id="r-packages">R Packages</h2>
<p>To be able to run all the examples in the book, install current versions of the following <code>CRAN</code> packages:</p>
<pre><code>Hmisc, rms, data.table, nlme, rmsb, ggplot2
kableExtra, pcaPP, VGAM, MASS, leaps, rpart</code></pre>
</section>
<section id="license" class="level2">
<h2 class="anchored" data-anchor-id="license">License</h2>
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="Creative Commons License" style="border-width:0"></a><br><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Regression Modeling Strategies Course</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.<br>Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://hbiostat.org/rmsc" rel="dct:source">https://hbiostat.org/rmsc</a>.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Update History
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 23%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Date</th>
<th style="text-align: left;">Sections</th>
<th style="text-align: left;">Changes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023-08-02</td>
<td style="text-align: left;"><strong>?@sec-missing-constraints</strong></td>
<td style="text-align: left;">New subsection on constraints for imputed values</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-08-01</td>
<td style="text-align: left;"><strong>?@sec-bacteremia</strong></td>
<td style="text-align: left;">New chapter for bacteremia case study</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-07-28</td>
<td style="text-align: left;"><strong>?@sec-intro-tep</strong></td>
<td style="text-align: left;">Added paired tests</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-07-21</td>
<td style="text-align: left;"><strong>?@sec-bodyfat</strong></td>
<td style="text-align: left;">New chapter: linear model case study</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-07-14</td>
<td style="text-align: left;"><strong>?@sec-mle-aic</strong></td>
<td style="text-align: left;">New material and links for AIC/BIC</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-05-30</td>
<td style="text-align: left;"><strong>?@sec-multivar-strategy</strong></td>
<td style="text-align: left;">Added consideration of confounding</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-05-24</td>
<td style="text-align: left;"><strong>?@sec-multivar-overfit</strong></td>
<td style="text-align: left;">Better effective sample size for binary <span class="math inline">\(Y\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-05-20</td>
<td style="text-align: left;"><strong>?@sec-lrcase1-pc</strong>, [-sec-impred-pc]</td>
<td style="text-align: left;">Added graphical display of PC loadings</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-04-30</td>
<td style="text-align: left;"><strong>?@sec-lrm</strong></td>
<td style="text-align: left;">Many improvements in graphics, and code using data.table</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-04-29</td>
<td style="text-align: left;"><strong>?@sec-genreg-gtrans</strong></td>
<td style="text-align: left;">Add likelihood ratio tests</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-04-22</td>
<td style="text-align: left;"><strong>?@sec-mle-hd</strong></td>
<td style="text-align: left;">New section on Hauck-Donner effect ruining Wald statistics</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-04-22</td>
<td style="text-align: left;"><strong>?@sec-lrm</strong><strong>?@sec-titanic-cd</strong></td>
<td style="text-align: left;">Added new <code>anova(..., test='LR')</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-03-06</td>
<td style="text-align: left;"><strong>?@sec-cony</strong></td>
<td style="text-align: left;">Several changes; replaced lattice graphics with ggplot2 and added validation with simultaneous multiple imputation</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-03-01</td>
<td style="text-align: left;"><strong>?@sec-val-mival</strong></td>
<td style="text-align: left;">New section on simultaneous validation and imputation</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-02-20</td>
<td style="text-align: left;"><strong>?@sec-impred</strong><strong>?@sec-lrcase1</strong></td>
<td style="text-align: left;">Used new Hmisc 5.0-0 function princmp for principal components</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-02-12</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Used rms 6.5-0 to improve code, removing results=‘asis’ from chunk headers</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-02-07</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Started moving study questions to end of chapters</td>
</tr>
<tr class="even">
<td style="text-align: left;">2022-10-28</td>
<td style="text-align: left;"><strong>?@sec-intro</strong></td>
<td style="text-align: left;">3 new flowcharts</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2022-10-28</td>
<td style="text-align: left;"><strong>?@sec-intro-gof</strong></td>
<td style="text-align: left;">New subsection of model uncertainty and GOF</td>
</tr>
<tr class="even">
<td style="text-align: left;">2022-09-16</td>
<td style="text-align: left;"><strong>?@sec-mle-ci</strong></td>
<td style="text-align: left;">Link to nice profile likelihood CI example</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="review-questions" class="level2">
<h2 class="anchored" data-anchor-id="review-questions">Review Questions</h2>
<ol type="1">
<li>Consider inference from comparing central tendencies of two groups on a continuous response variable Y. What assumptions are you willing to make when selecting a statistical test? Why are you willing to make those assumptions?</li>
<li>Consider the comparison of 5 groups on a continuous Y. Suppose you observe that two of the groups have a similar mean and the other three also have a similar sample mean. What is wrong with combining the two samples and combining the three samples, then comparing two means? How does this compare to stepwise variable selection?</li>
<li>Name a specific statistical test for which we don’t have a corresponding statistical model</li>
<li>Concerning a multi-group problem or a sequential testing problem what is the frequentist approach to multiplicity correction? The Bayesian approach?</li>
</ol>
<p>Copyright 2023, Frank E Harrell Jr</p>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Thanks to Drew Levy for ideas that greatly improved this section.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>